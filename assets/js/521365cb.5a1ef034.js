"use strict";(self.webpackChunkochocast=self.webpackChunkochocast||[]).push([[1610],{7285:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"documentation/tutorial-extras/rtmpServer","title":"Serveur RTMP","description":"Docker RTMP-HLS","source":"@site/docs/documentation/03-tutorial-extras/03-rtmpServer.md","sourceDirName":"documentation/03-tutorial-extras","slug":"/documentation/tutorial-extras/rtmpServer","permalink":"/docs/documentation/tutorial-extras/rtmpServer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"POC - Migration des vid\xe9os Ubicast - Scaleway","permalink":"/docs/documentation/tutorial-extras/ubicast"},"next":{"title":"Serveur Web Socket","permalink":"/docs/documentation/tutorial-extras/WebSocketServer"}}');var i=s(4848),l=s(8453);const t={},c="Serveur RTMP",d={},o=[{value:"Docker RTMP-HLS",id:"docker-rtmp-hls",level:2},{value:"Description",id:"description",level:2},{value:"Fonctionnalit\xe9s",id:"fonctionnalit\xe9s",level:2},{value:"Utilisation",id:"utilisation",level:2},{value:"Pour construire l&#39;image",id:"pour-construire-limage",level:3},{value:"Pour ex\xe9cuter le serveur",id:"pour-ex\xe9cuter-le-serveur",level:3},{value:"Pour streamer vers le serveur",id:"pour-streamer-vers-le-serveur",level:3},{value:"Pour visualiser le flux",id:"pour-visualiser-le-flux",level:3},{value:"Copyright",id:"copyright",level:2},{value:"D\xe9ploiement",id:"d\xe9ploiement",level:2}];function a(e){const r={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"serveur-rtmp",children:"Serveur RTMP"})}),"\n",(0,i.jsx)(r.h2,{id:"docker-rtmp-hls",children:"Docker RTMP-HLS"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Image Docker pour serveur de streaming vid\xe9o qui prend en charge les flux RTMP, HLS et DASH."})}),"\n",(0,i.jsx)(r.h2,{id:"description",children:"Description"}),"\n",(0,i.jsxs)(r.p,{children:["Cette image Docker peut \xeatre utilis\xe9e pour cr\xe9er un serveur de streaming vid\xe9o prenant en charge les flux ",(0,i.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol",children:(0,i.jsx)(r.strong,{children:"RTMP"})}),", ",(0,i.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/HTTP_Live_Streaming",children:(0,i.jsx)(r.strong,{children:"HLS"})}),", ",(0,i.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Dynamic_Adaptive_Streaming_over_HTTP",children:(0,i.jsx)(r.strong,{children:"DASH"})})," d\xe8s la sortie de la bo\xeete. Elle permet \xe9galement le streaming adaptatif et la transcodification personnalis\xe9e des flux vid\xe9o.\nLe module est construit \xe0 partir du code source sur une image de base Alpine Linux."]}),"\n",(0,i.jsx)(r.h2,{id:"fonctionnalit\xe9s",children:"Fonctionnalit\xe9s"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Le backend est ",(0,i.jsx)(r.a,{href:"http://nginx.org/fr/",children:(0,i.jsx)(r.strong,{children:"Nginx"})})," avec le ",(0,i.jsx)(r.a,{href:"https://github.com/arut/nginx-rtmp-module",children:(0,i.jsx)(r.strong,{children:"nginx-rtmp-module"})}),"."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"https://www.ffmpeg.org/",children:(0,i.jsx)(r.strong,{children:"FFmpeg"})})," pour la transcodification et le streaming adaptatif."]}),"\n",(0,i.jsxs)(r.li,{children:["Param\xe8tres par d\xe9faut :","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"RTMP activ\xe9"}),"\n",(0,i.jsx)(r.li,{children:"HLS activ\xe9 (adaptatif, 5 variantes)"}),"\n",(0,i.jsx)(r.li,{children:"DASH activ\xe9"}),"\n",(0,i.jsx)(r.li,{children:"Un autre fichier de configuration Nginx est \xe9galement fourni pour permettre un streaming sans transcodification via FFmpeg."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["Page de statistiques des flux RTMP accessible \xe0 ",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:<port_du_serveur>/stats"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:["Lecteurs vid\xe9o web disponibles (bas\xe9s sur ",(0,i.jsx)(r.a,{href:"https://videojs.com/",children:"video.js"})," et ",(0,i.jsx)(r.a,{href:"https://github.com/video-dev/hls.js/",children:"hls.js"}),") dans ",(0,i.jsx)(r.code,{children:"/usr/local/nginx/html/players"}),"."]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"L'image actuelle est construite avec :"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Nginx 1.21.5 (compil\xe9 \xe0 partir du code source) (les versions plus r\xe9centes de Nginx semblent avoir des probl\xe8mes avec la page de statistiques (pid 8))"}),"\n",(0,i.jsx)(r.li,{children:"Nginx-rtmp-module 1.2.2 (compil\xe9 \xe0 partir du code source)"}),"\n",(0,i.jsx)(r.li,{children:"FFmpeg 6.0 (compil\xe9 \xe0 partir du code source)"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"utilisation",children:"Utilisation"}),"\n",(0,i.jsx)(r.h3,{id:"pour-construire-limage",children:"Pour construire l'image"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"docker build -t octocast_rtmp_server .\n"})}),"\n",(0,i.jsx)(r.h3,{id:"pour-ex\xe9cuter-le-serveur",children:"Pour ex\xe9cuter le serveur"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"docker run -d -p 1935:1935 -p 8080:8080 octocast_rtmp_server\n"})}),"\n",(0,i.jsxs)(r.p,{children:["o\xf9 ",(0,i.jsx)(r.code,{children:"1935"})," est le port RTMP et ",(0,i.jsx)(r.code,{children:"8080"})," est le port HTTP."]}),"\n",(0,i.jsx)(r.h3,{id:"pour-streamer-vers-le-serveur",children:"Pour streamer vers le serveur"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Streamer du contenu RTMP en direct vers :"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"rtmp://<server ip>:1935/live/<stream_key>\n"})}),"\n",(0,i.jsxs)(r.p,{children:["o\xf9 ",(0,i.jsx)(r.code,{children:"<stream_key>"})," est la cl\xe9 de flux que vous sp\xe9cifiez."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsxs)(r.strong,{children:["Configurer ",(0,i.jsx)(r.a,{href:"https://obsproject.com/",children:"OBS"})," pour streamer le contenu :"]})," ",(0,i.jsx)("br",{}),"\nAllez dans Param\xe8tres > Stream, choisissez les param\xe8tres suivants :"]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:"Service : Serveur de Streaming personnalis\xe9."}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Serveur : ",(0,i.jsx)(r.code,{children:"rtmp://<ip_du_serveur>:1935/live"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Cl\xe9 de flux : choisissez ce que vous voulez, cependant les lecteurs vid\xe9o fournis supposent que la cl\xe9 de flux est ",(0,i.jsx)(r.code,{children:"test"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"pour-visualiser-le-flux",children:"Pour visualiser le flux"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:(0,i.jsxs)(r.strong,{children:["Avec ",(0,i.jsx)(r.a,{href:"https://www.videolan.org/vlc/index.html",children:"VLC"})," :"]})}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:"Allez dans M\xe9dia > Ouvrir un flux r\xe9seau."}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Entrez l'URL du flux : ",(0,i.jsx)(r.code,{children:"rtmp://<ip_du_serveur>:1935/live/<stream-key>"}),"\nRemplacez ",(0,i.jsx)(r.code,{children:"<ip_du_serveur>"})," par l'adresse IP du serveur, et ",(0,i.jsx)(r.code,{children:"<stream-key>"})," par la cl\xe9 de flux que vous avez utilis\xe9e pour configurer le stream."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Pour HLS et DASH, les URLs sont sous les formes :",(0,i.jsx)(r.br,{}),"\n",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:8080/hls/<stream-key>.m3u8"})," et",(0,i.jsx)(r.br,{}),"\n",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:8080/dash/<stream-key>_src.mpd"})," respectivement."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsx)(r.p,{children:"Cliquez sur Play."}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Avec les lecteurs web fournis : (fournis dans le repo poc)"}),(0,i.jsx)(r.br,{}),"\n","Les lecteurs de d\xe9monstration supposent que la cl\xe9 de flux est appel\xe9e ",(0,i.jsx)(r.code,{children:"test"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Pour lire du contenu HLS : ",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:8080/players/hls.html"})]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Pour lire du contenu HLS avec la biblioth\xe8que hls.js : ",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:8080/players/hls_hlsjs.html"})]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Pour lire du contenu DASH : ",(0,i.jsx)(r.code,{children:"http://<ip_du_serveur>:8080/players/dash.html"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"copyright",children:"Copyright"}),"\n",(0,i.jsx)(r.p,{children:"Publi\xe9 sous la licence MIT."}),"\n",(0,i.jsx)(r.h2,{id:"d\xe9ploiement",children:"D\xe9ploiement"}),"\n",(0,i.jsxs)(r.p,{children:["lien de r\xe9cup\xe9ration RTMP : ",(0,i.jsx)(r.code,{children:"rg.fr-par.scw.cloud/rtmp-server-images/octocast_rtmp_server:latest"})]})]})}function u(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>t,x:()=>c});var n=s(6540);const i={},l=n.createContext(i);function t(e){const r=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),n.createElement(l.Provider,{value:r},e.children)}}}]);