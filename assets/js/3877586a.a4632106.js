"use strict";(self.webpackChunkochocast=self.webpackChunkochocast||[]).push([[3076],{6811:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"documentation/tutorial-extras/ubicast","title":"POC - Migration des vid\xe9os Ubicast - Scaleway","description":"Ce script permet de r\xe9cup\xe9rer les vid\xe9os depuis la plateforme Ubicast et de les stocker sur Scaleway en utilisant AWS S3. Il enregistre \xe9galement les m\xe9tadonn\xe9es des vid\xe9os dans la base de donn\xe9es PostgreSQL du projet.","source":"@site/docs/documentation/03-tutorial-extras/02-ubicast.md","sourceDirName":"documentation/03-tutorial-extras","slug":"/documentation/tutorial-extras/ubicast","permalink":"/docs/documentation/tutorial-extras/ubicast","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Personalisation","permalink":"/docs/documentation/tutorial-extras/personalisation"},"next":{"title":"Serveur RTMP","permalink":"/docs/documentation/tutorial-extras/rtmpServer"}}');var d=s(4848),r=s(8453);const l={},t="POC - Migration des vid\xe9os Ubicast - Scaleway",c={},o=[{value:"Fonctionnalit\xe9s",id:"fonctionnalit\xe9s",level:2},{value:"Installation des d\xe9pendances",id:"installation-des-d\xe9pendances",level:2},{value:"Ex\xe9cution du script",id:"ex\xe9cution-du-script",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Fonctionnalit\xe9s principales",id:"fonctionnalit\xe9s-principales",level:3},{value:"Am\xe9liorations \xe0 impl\xe9menter (TODO)",id:"am\xe9liorations-\xe0-impl\xe9menter-todo",level:2},{value:"Configuration",id:"configuration-1",level:2},{value:"1. <strong>Variables de connexion</strong>",id:"1-variables-de-connexion",level:3},{value:"1. <strong>Base de donn\xe9es PostgreSQL</strong>",id:"1-base-de-donn\xe9es-postgresql",level:3},{value:"Fonctionnement d\xe9taill\xe9",id:"fonctionnement-d\xe9taill\xe9",level:2},{value:"Gestion des erreurs",id:"gestion-des-erreurs",level:2},{value:"Suivi des performances",id:"suivi-des-performances",level:2},{value:"Ex\xe9cution et logs",id:"ex\xe9cution-et-logs",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"poc---migration-des-vid\xe9os-ubicast---scaleway",children:"POC - Migration des vid\xe9os Ubicast - Scaleway"})}),"\n",(0,d.jsx)(n.p,{children:"Ce script permet de r\xe9cup\xe9rer les vid\xe9os depuis la plateforme Ubicast et de les stocker sur Scaleway en utilisant AWS S3. Il enregistre \xe9galement les m\xe9tadonn\xe9es des vid\xe9os dans la base de donn\xe9es PostgreSQL du projet."}),"\n",(0,d.jsx)(n.h2,{id:"fonctionnalit\xe9s",children:"Fonctionnalit\xe9s"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Connexion \xe0 l'API Ubicast pour r\xe9cup\xe9rer les vid\xe9os."}),"\n",(0,d.jsx)(n.li,{children:"Stockage des vid\xe9os sur Scaleway via AWS S3."}),"\n",(0,d.jsx)(n.li,{children:"Enregistrement des m\xe9tadonn\xe9es des vid\xe9os dans la base PostgreSQL du projet."}),"\n",(0,d.jsxs)(n.li,{children:["La recherche des vid\xe9os peut se faire par deux moyens :","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Chargement des identifiants de vid\xe9os (",(0,d.jsx)(n.code,{children:"oids"}),") depuis un fichier CSV."]}),"\n",(0,d.jsx)(n.li,{children:"Recherche exhaustive des vid\xe9os en parcourant divers termes de recherche."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h1,{id:"installation-et-ex\xe9cution",children:"Installation et ex\xe9cution"}),"\n",(0,d.jsx)(n.h2,{id:"installation-des-d\xe9pendances",children:"Installation des d\xe9pendances"}),"\n",(0,d.jsx)(n.p,{children:"Avant d'ex\xe9cuter le script, installez les d\xe9pendances n\xe9cessaires avec la commande :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sh",children:"npm install\n"})}),"\n",(0,d.jsx)(n.h2,{id:"ex\xe9cution-du-script",children:"Ex\xe9cution du script"}),"\n",(0,d.jsx)(n.p,{children:"Lancez le script avec la commande suivante :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sh",children:"node downloadOctoVideo.js\n"})}),"\n",(0,d.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,d.jsx)(n.p,{children:"Le script utilise plusieurs variables d\u2019environnement pour stocker les informations sensibles :"}),"\n",(0,d.jsx)(n.h3,{id:"fonctionnalit\xe9s-principales",children:"Fonctionnalit\xe9s principales"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"R\xe9cup\xe9ration des vid\xe9os (deux m\xe9thodes, \xe0 voir laquelle est la plus efficiente) :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Par requ\xeate directe via leurs identifiants (",(0,d.jsx)(n.code,{children:"oids"}),")."]}),"\n",(0,d.jsx)(n.li,{children:"Par recherche exhaustive sur l\u2019API de UbiCast (comment\xe9 pour l'instant dans le code)."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"T\xe9l\xe9chargement et upload :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"T\xe9l\xe9chargement des vid\xe9os depuis l\u2019API UbiCast."}),"\n",(0,d.jsx)(n.li,{children:"Upload vers un bucket Scaleway S3."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Base de donn\xe9es :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Connexion \xe0 une base PostgreSQL."}),"\n",(0,d.jsx)(n.li,{children:"Insertion des m\xe9tadonn\xe9es des vid\xe9os."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"am\xe9liorations-\xe0-impl\xe9menter-todo",children:"Am\xe9liorations \xe0 impl\xe9menter (TODO)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Int\xe9grer les miniatures d\u2019UbiCast dans la base de donn\xe9es."}),"\n",(0,d.jsx)(n.li,{children:"R\xe9cup\xe9rer et stocker les miniatures d\u2019UbiCast sur Scaleway."}),"\n",(0,d.jsx)(n.li,{children:"Am\xe9liorer la recherche de vid\xe9os (via API Search ou fichier Excel)."}),"\n",(0,d.jsx)(n.li,{children:"Automatiser la r\xe9cup\xe9ration de toutes les vid\xe9os UbiCast."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"configuration-1",children:"Configuration"}),"\n",(0,d.jsxs)(n.h3,{id:"1-variables-de-connexion",children:["1. ",(0,d.jsx)(n.strong,{children:"Variables de connexion"})]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Variable"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"API_KEY"})}),(0,d.jsx)(n.td,{children:"Cl\xe9 API pour acc\xe9der \xe0 l\u2019API UbiCast."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"API_BASE_URL"})}),(0,d.jsx)(n.td,{children:"URL de l\u2019API UbiCast."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"BUCKET_NAME"})}),(0,d.jsx)(n.td,{children:"Nom du bucket Scaleway o\xf9 les vid\xe9os seront stock\xe9es."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"REGION"})}),(0,d.jsx)(n.td,{children:"R\xe9gion du service Scaleway."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"S3_ACCESS_KEY"})}),(0,d.jsx)(n.td,{children:"Cl\xe9 d\u2019acc\xe8s Scaleway S3."})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"S3_SECRET_KEY"})}),(0,d.jsx)(n.td,{children:"Cl\xe9 secr\xe8te Scaleway S3."})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"Les valeurs des variables sensibles doivent \xeatre configur\xe9es dans le fichier .env ou des secrets d\u2019environnement."}),"\n",(0,d.jsxs)(n.h3,{id:"1-base-de-donn\xe9es-postgresql",children:["1. ",(0,d.jsx)(n.strong,{children:"Base de donn\xe9es PostgreSQL"})]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Param\xe8tre"}),(0,d.jsx)(n.th,{children:"Valeur"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"user"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"octocast-db-prod"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"host"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"51.159.205.159"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"database"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"rdb"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"password"})}),(0,d.jsx)(n.td,{children:"Mot de passe requis"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"port"})}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"5253"})})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"fonctionnement-d\xe9taill\xe9",children:"Fonctionnement d\xe9taill\xe9"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Connexion et fermeture de la base de donn\xe9es"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"connectDatabase()"}),": \xc9tablit la connexion PostgreSQL."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"closeDatabase()"}),": Ferme la connexion PostgreSQL."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Chargement des vid\xe9os"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"loadOidsFromCsv(filePath)"}),": Charge une liste d\u2019identifiants (oids) depuis un fichier CSV extrait d'Ubicast, contenant l'ensemble des informations des vid\xe9os h\xe9berg\xe9es."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"fetchAllVideosExhaustively()"}),": R\xe9cup\xe8re toutes les vid\xe9os \xe0 partir de leurs ",(0,d.jsx)(n.code,{children:"oids"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"R\xe9cup\xe9ration des vid\xe9os"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"fetchVideoDetails(oid)"}),": R\xe9cup\xe8re les m\xe9tadonn\xe9es compl\xe8tes d\u2019une vid\xe9o."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"fetchVideosWithSearch(searchTerm)"}),": Effectue une recherche de vid\xe9os par mot-cl\xe9."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Traitement des vid\xe9os"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"addUniqueVideos(videos)"}),": Ajoute des vid\xe9os \xe0 la liste en s\u2019assurant qu\u2019il n\u2019y a pas de doublons."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"processVideo(video)"}),": T\xe9l\xe9charge, uploade et enregistre une vid\xe9o dans la base de donn\xe9es."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Migration compl\xe8te"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"migrateVideos()"}),": Orchestration de l\u2019ensemble du processus."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"gestion-des-erreurs",children:"Gestion des erreurs"}),"\n",(0,d.jsx)(n.p,{children:"Le script inclut plusieurs m\xe9canismes de gestion d\u2019erreurs :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"V\xe9rification des connexions \xe0 l\u2019API et \xe0 la base de donn\xe9es."}),"\n",(0,d.jsx)(n.li,{children:"V\xe9rification du statut HTTP des requ\xeates API."}),"\n",(0,d.jsx)(n.li,{children:"Gestion des erreurs d\u2019upload avec un suivi de progression."}),"\n",(0,d.jsx)(n.li,{children:"V\xe9rification et gestion des conflits lors de l\u2019insertion en base de donn\xe9es."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"suivi-des-performances",children:"Suivi des performances"}),"\n",(0,d.jsx)(n.p,{children:"\xc0 la fin de l\u2019ex\xe9cution du script, un bilan des op\xe9rations est affich\xe9 :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Nombre de vid\xe9os ajout\xe9es en base de donn\xe9es."}),"\n",(0,d.jsx)(n.li,{children:"Nombre de vid\xe9os upload\xe9es sur Scaleway."}),"\n",(0,d.jsx)(n.li,{children:"Nombre d\u2019\xe9checs de migration."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"ex\xe9cution-et-logs",children:"Ex\xe9cution et logs"}),"\n",(0,d.jsx)(n.p,{children:"Le script affiche des logs d\xe9taill\xe9s pour suivre l\u2019avancement :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Connexion \xe0 la base de donn\xe9es r\xe9ussie."}),"\n",(0,d.jsx)(n.li,{children:'Recherche avec le terme : "A"'}),"\n",(0,d.jsx)(n.li,{children:"T\xe9l\xe9chargement de la vid\xe9o : exemple.mp4"}),"\n",(0,d.jsx)(n.li,{children:"Upload de la vid\xe9o sur Scaleway : exemple.mp4"}),"\n",(0,d.jsx)(n.li,{children:'Vid\xe9o "exemple.mp4" upload\xe9e avec succ\xe8s.'}),"\n",(0,d.jsx)(n.li,{children:'Vid\xe9o "exemple.mp4" ins\xe9r\xe9e dans la base de donn\xe9es.'}),"\n",(0,d.jsx)(n.li,{children:"Migration termin\xe9e !"}),"\n",(0,d.jsx)(n.li,{children:"Nombre total de vid\xe9os ajout\xe9es en base de donn\xe9es : 42"}),"\n",(0,d.jsx)(n.li,{children:"Nombre total de vid\xe9os upload\xe9es dans le bucket Scaleway : 38"}),"\n",(0,d.jsx)(n.li,{children:"Nombre total de vid\xe9os ayant \xe9chou\xe9 : 4"}),"\n"]}),"\n",(0,d.jsx)(n.h1,{id:"auteur",children:"Auteur"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"D\xe9veloppeur(s) : Oriane Margelisch"}),"\n",(0,d.jsx)(n.li,{children:"Derni\xe8re mise \xe0 jour : 2024-01-29"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(6540);const d={},r=i.createContext(d);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);