"use strict";(self.webpackChunkochocast=self.webpackChunkochocast||[]).push([[3688],{3231:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"documentation/tools/Base de donnees","title":"Base de donn\xe9es","description":"Dans ce projet, nous utilisons TypeORM pour interagir avec la base de donn\xe9es PostgreSQL.","source":"@site/docs/documentation/02-tools/06-Base de donnees.md","sourceDirName":"documentation/02-tools","slug":"/documentation/tools/Base de donnees","permalink":"/docs/documentation/tools/Base de donnees","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CI/CD","permalink":"/docs/documentation/tools/CI-CD"},"next":{"title":"Extras","permalink":"/docs/category/extras"}}');var i=t(4848),o=t(8453);const a={},r="Base de donn\xe9es",l={},d=[{value:"1- Cr\xe9er une migration",id:"1--cr\xe9er-une-migration",level:2},{value:"2- Ex\xe9cuter une migration",id:"2--ex\xe9cuter-une-migration",level:2},{value:"3- Application en production",id:"3--application-en-production",level:2},{value:"4- R\xe9solution de probl\xe8mes",id:"4--r\xe9solution-de-probl\xe8mes",level:2},{value:"4.1- Les changements sont d\xe9j\xe0 appliqu\xe9s",id:"41--les-changements-sont-d\xe9j\xe0-appliqu\xe9s",level:3},{value:"4.2- Une colonne \xe0 NULL pose probl\xe8me",id:"42--une-colonne-\xe0-null-pose-probl\xe8me",level:3}];function c(e){const n={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"base-de-donn\xe9es",children:"Base de donn\xe9es"})}),"\n",(0,i.jsx)(n.p,{children:"Dans ce projet, nous utilisons TypeORM pour interagir avec la base de donn\xe9es PostgreSQL."}),"\n",(0,i.jsx)(n.p,{children:"Lorsqu'on change une propri\xe9t\xe9 d'une entity (exemple du fichier : /backend/src/tags/infra/gateways/entities/tag.entity.ts), cela change la description de l'objet en base de donn\xe9es (par exemple ajouter un champ \"toto\" dans l'entity va ajouter une colonne \"toto\" \xe0 la table tag_entity)."}),"\n",(0,i.jsx)(n.p,{children:"Ces changements peuvent \xeatre appliqu\xe9s automatiquement en cr\xe9ant et \xe9x\xe9cutant une migration."}),"\n",(0,i.jsx)(n.h2,{id:"1--cr\xe9er-une-migration",children:"1- Cr\xe9er une migration"}),"\n",(0,i.jsx)(n.p,{children:"Apr\xe8s avoir chang\xe9 les champs dans l'entity, ouvrir un terminal dans le dossier /backend/"}),"\n",(0,i.jsxs)(n.p,{children:['Pour g\xe9n\xe9rer une migration, utiliser la commande "npm run migration',":generate",'"']}),"\n",(0,i.jsx)(n.p,{children:"Une nouvelle migration a \xe9t\xe9 cr\xe9\xe9e dans le dossier /backend/migrations, il faut s'assurer que les changements de la migration (en requ\xeates postgreSQL) correspondent aux changements qui ont \xe9t\xe9 effectu\xe9s dans l'entity."}),"\n",(0,i.jsx)(n.h2,{id:"2--ex\xe9cuter-une-migration",children:"2- Ex\xe9cuter une migration"}),"\n",(0,i.jsxs)(n.p,{children:['Pour \xe9x\xe9cuter une migration (et donc appliquer les changements \xe0 la base de donn\xe9es), dans le dossier /backend/, utiliser la commande "npm run migration',":run",'".']}),"\n",(0,i.jsx)(n.p,{children:"Si il n'y a pas de message d'erreurs, les modifications ont \xe9t\xe9es appliqu\xe9es dans la base de donn\xe9es locale."}),"\n",(0,i.jsx)(n.h2,{id:"3--application-en-production",children:"3- Application en production"}),"\n",(0,i.jsx)(n.p,{children:"Gr\xe2ce \xe0 la CI / CD, les migrations qui ont \xe9t\xe9es push sont automatiquement effectu\xe9es lors de la mise en production avec les m\xeames commandes qu'en local"}),"\n",(0,i.jsx)(n.h2,{id:"4--r\xe9solution-de-probl\xe8mes",children:"4- R\xe9solution de probl\xe8mes"}),"\n",(0,i.jsx)(n.p,{children:"Si probl\xe8me survient lors de l'\xe9x\xe9cution des migrations, il y a plusieurs points \xe0 v\xe9rifier :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"est-ce que les changements ont d\xe9j\xe0 \xe9t\xe9 appliqu\xe9s sans la migration ?"}),"\n",(0,i.jsx)(n.li,{children:"est-ce que les changements sont impossible \xe0 appliquer \xe0 cause de contraintes (cr\xe9ation d'une nouvelle colonne qui ne peut pas \xeatre NUL et sans valeur par d\xe9faut)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"41--les-changements-sont-d\xe9j\xe0-appliqu\xe9s",children:"4.1- Les changements sont d\xe9j\xe0 appliqu\xe9s"}),"\n",(0,i.jsx)(n.p,{children:"Si tous les changements de la migration sont d\xe9j\xe0 en base, il est possible d'ajouter directement la migration aux migrations effectu\xe9es dans la base de donn\xe9es postgreSQL."}),"\n",(0,i.jsx)(n.p,{children:"Pour r\xe9soudre ce probl\xe8me :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'se connecter manuellement \xe0 la base de donn\xe9es et v\xe9rifier la table "migrations"'}),"\n",(0,i.jsx)(n.li,{children:'ins\xe9rer dans la table "migrations" les valeurs suivantes l\'identifiant de la migration (name) et le timestamp actuel (timestamp)'}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['v\xe9rifier que la migration a bien \xe9t\xe9 ajout\xe9e en relan\xe7ant la commande "npm run migration',":run",'"']}),"\n",(0,i.jsx)(n.h3,{id:"42--une-colonne-\xe0-null-pose-probl\xe8me",children:"4.2- Une colonne \xe0 NULL pose probl\xe8me"}),"\n",(0,i.jsx)(n.p,{children:"Ajouter une valeur par d\xe9faut ou supprimer la contrainte NOT NULL de la colonne dans l'entity, supprimer le fichier de migration qui pose probl\xe8me puis relance les commandes de g\xe9n\xe9ration et d'\xe9x\xe9cution de migration."})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);